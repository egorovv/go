#!/bin/bash

set -e
set -x

DIR=$(readlink -f $(dirname $0)/..)

export GOOS=esx
export GOARCH=amd64
export GOROOT=$DIR
export PATH=$GOROOT/bin:$PATH

if [ "$1" == "-c" ]; then
    export CGO_ENABLED=1
    export ESX_SYSROOT=/build/mts/release/bora-3698047/publish/sysroot
    export ESX_TOOLCHAIN=/build/mts/release/bora-3657877/publish
    export CC="$ESX_TOOLCHAIN/usr/bin/x86_64-vmk-linux-gnu-gcc"
    export CXX="$ESX_TOOLCHAIN/usr/bin/x86_64-vmk-linux-gnu-g++"
    export CC_FOR_TARGET="$CC"
    export CXX_FOR_TARGET="$CXX"
    export CGO_CFLAGS="--sysroot=${ESX_SYSROOT} ${CGO_CFLAGS}"
    export CGO_LDFLAGS="--sysroot=${ESX_SYSROOT} ${CGO_LDFLAGS}"
    shift
fi

args="$@"
if [ -z "$args" ] ; then
    /bin/bash --norc --noprofile
fi
"$@"


